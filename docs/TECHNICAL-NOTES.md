# æŠ€è¡“ç­†è¨˜èˆ‡ç¶“é©—

æœ¬æ–‡ä»¶è¨˜éŒ„é–‹ç™¼éç¨‹ä¸­é‡åˆ°çš„é‡è¦æŠ€è¡“å•é¡Œã€è§£æ±ºæ–¹æ¡ˆå’Œç¶“é©—æ•™è¨“ã€‚

## ğŸ¤– AI å°è®€èˆ‡é–‹ç™¼æ³¨æ„äº‹é … (AI Context & Pitfalls)

**çµ¦æœªä¾†çš„ AI é–‹ç™¼è€…**ï¼šæœ¬å°ˆæ¡ˆæ˜¯åŸºæ–¼ HTML5 Canvas çš„è¼•é‡ç´š RPGï¼Œé›–ç„¶ç¨‹å¼ç¢¼ä¸é•·ï¼Œä½†æœ‰å¹¾å€‹æ ¸å¿ƒæ©Ÿåˆ¶æ¥µæ˜“å‡ºéŒ¯ã€‚è«‹åœ¨ä¿®æ”¹å‰ä»”ç´°é–±è®€ä»¥ä¸‹é‡é»ã€‚

### ç‰ˆæœ¬è™Ÿç®¡ç†è¦å‰‡ (Version Management)

**é‡è¦**ï¼šç‰ˆæœ¬è™Ÿå®šç¾©åœ¨ `script.js` é–‹é ­çš„ `GAME_VERSION` å¸¸æ•¸ï¼ˆæ ¼å¼ï¼š`"X.Y.Z"`ï¼‰ã€‚

#### ç‰ˆæœ¬è™Ÿæ ¼å¼
ä½¿ç”¨ **Semantic Versioning (èªç¾©åŒ–ç‰ˆæœ¬)**ï¼š
- **MAJOR (X)**ï¼šå¤§æ”¹ç‰ˆï¼Œé‡å¤§åŠŸèƒ½è®Šæ›´æˆ–æ¶æ§‹èª¿æ•´
- **MINOR (Y)**ï¼šä¸­æ”¹ç‰ˆï¼Œæ–°å¢åŠŸèƒ½æˆ–é‡è¦æ”¹é€²
- **PATCH (Z)**ï¼šå°æ”¹ç‰ˆï¼ŒBug ä¿®å¾©ã€æ•¸å€¼èª¿æ•´ã€UI å„ªåŒ–ç­‰

#### AI è‡ªå‹•ç®¡ç†è¦å‰‡
- **å°æ”¹ç‰ˆ (PATCH)**ï¼šAI åœ¨å®Œæˆä¿®æ”¹å¾Œè‡ªå‹•å¢åŠ  PATCH ç‰ˆæœ¬è™Ÿï¼ˆZ+1ï¼‰
  - ä¾‹å¦‚ï¼š`1.0.0` â†’ `1.0.1`
  - é©ç”¨æ–¼ï¼šBug ä¿®å¾©ã€æ•¸å€¼å¹³è¡¡èª¿æ•´ã€UI å¾®èª¿ã€æ–‡å­—ä¿®æ­£ã€æ•ˆèƒ½å„ªåŒ–ç­‰
- **ä¸­æ”¹ç‰ˆ (MINOR)**ï¼šAI åœ¨å®Œæˆä¿®æ”¹å¾Œè‡ªå‹•å¢åŠ  MINOR ç‰ˆæœ¬è™Ÿï¼ˆY+1ï¼ŒZ æ­¸é›¶ï¼‰
  - ä¾‹å¦‚ï¼š`1.0.5` â†’ `1.1.0`
  - é©ç”¨æ–¼ï¼šæ–°å¢åŠŸèƒ½ã€æ–°å¢è·æ¥­ã€æ–°å¢å‡ç´šé¸é …ã€æ–°å¢éŠæˆ²æ©Ÿåˆ¶ç­‰
- **å¤§æ”¹ç‰ˆ (MAJOR)**ï¼š**ç”±ç”¨æˆ¶æ‰‹å‹•å¢åŠ **ï¼ŒAI ä¸å¾—è‡ªå‹•ä¿®æ”¹
  - ä¾‹å¦‚ï¼š`1.5.0` â†’ `2.0.0`
  - é©ç”¨æ–¼ï¼šé‡å¤§æ¶æ§‹è®Šæ›´ã€æ ¸å¿ƒç©æ³•æ”¹è®Šã€å¤§è¦æ¨¡é‡æ§‹ç­‰

#### å¯¦ä½œç¯„ä¾‹
```javascript
// script.js é–‹é ­
const GAME_VERSION = "1.0.0";  // ç•¶å‰ç‰ˆæœ¬

// AI å®Œæˆå°æ”¹ç‰ˆå¾Œè‡ªå‹•æ›´æ–°ç‚ºï¼š
const GAME_VERSION = "1.0.1";

// AI å®Œæˆä¸­æ”¹ç‰ˆå¾Œè‡ªå‹•æ›´æ–°ç‚ºï¼š
const GAME_VERSION = "1.1.0";

// å¤§æ”¹ç‰ˆç”±ç”¨æˆ¶æ‰‹å‹•æ›´æ–°ï¼ŒAI ä¸æ‡‰ä¿®æ”¹
```

#### æ³¨æ„äº‹é …
- æ¯æ¬¡ä¿®æ”¹å®Œæˆå¾Œï¼ŒAI æ‡‰æª¢æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°ç‰ˆæœ¬è™Ÿ
- å¦‚æœç”¨æˆ¶æ˜ç¢ºè¦æ±‚å¤§æ”¹ç‰ˆï¼ŒAI æ‡‰æé†’ç”¨æˆ¶æ‰‹å‹•æ›´æ–°ç‰ˆæœ¬è™Ÿ
- ç‰ˆæœ¬è™Ÿåªé¡¯ç¤ºåœ¨ä¸»é¸å–®ï¼ŒéŠæˆ²ç•«é¢ä¸­ä¸é¡¯ç¤º

### 1. ç³»çµ±æ¶æ§‹æ ¸å¿ƒ
- **å‡ç´šç³»çµ±æ˜¯æ ¸å¿ƒ**ï¼šæ‰€æœ‰æ•¸å€¼ï¼ˆå‚·å®³ã€ç¯„åœã€é€Ÿåº¦ï¼‰éƒ½æ‡‰å¾ `upgrade-config.js` è®€å–ï¼Œ**çµ•å°ä¸è¦**åœ¨ `script.js` ç¡¬ç·¨ç¢¼æ•¸å€¼ã€‚
- **GM æ¸¬è©¦å·¥å…·**ï¼š`syncPlayerLevelWithUpgrades()` æ˜¯ä¸€å€‹é—œéµå‡½æ•¸ï¼Œå®ƒå°‡ã€Œèƒ½åŠ›ç¸½ç­‰ç´šã€èˆ‡ã€Œç©å®¶ç­‰ç´šã€ç¶å®šã€‚ä¿®æ”¹å‡ç´šé‚è¼¯æ™‚ï¼Œå‹™å¿…ç¢ºèªæ­¤åŒæ­¥æ©Ÿåˆ¶æ˜¯å¦å—åˆ°å½±éŸ¿ã€‚
- **åº§æ¨™ç³»çµ±**ï¼š
  - **é‚è¼¯åº§æ¨™**ï¼š`s.x`, `s.y`ï¼ˆç¶²æ ¼åº§æ¨™ï¼Œæ•´æ•¸ï¼‰ã€‚
  - **è¦–è¦ºåº§æ¨™**ï¼š`s.renderX`, `s.renderY`ï¼ˆåƒç´ åº§æ¨™ï¼Œæµ®é»æ•¸ï¼Œç”¨æ–¼å¹³æ»‘ç§»å‹•ï¼‰ã€‚
  - **ç¢°æ’æª¢æ¸¬**ï¼šåŸºæ–¼**é‚è¼¯åº§æ¨™**ï¼ˆ`moveSnake`ï¼‰æˆ–**åƒç´ è·é›¢**ï¼ˆ`updateEnemies`ï¼‰ã€‚ä¿®æ”¹ç¢°æ’é‚è¼¯æ™‚è¦å°å¿ƒå€åˆ†ã€‚
  - **ç‰¹æ•ˆç¹ªè£½**ï¼šå¿…é ˆç¶“é `camera.transform` è½‰æ›ç‚ºè¢å¹•åº§æ¨™ï¼Œ**ä¸è¦**ç›´æ¥ç¹ªè£½ä¸–ç•Œåº§æ¨™ã€‚

### 2. å®¹æ˜“å‡ºéŒ¯çš„é™·é˜± (Pitfalls)
- **âŒ é›™é‡å‚·å®³é‚è¼¯**ï¼šå¼“ç®­çˆ†ç‚¸ç¾åœ¨æœƒå°ã€Œè¢«æ“Šä¸­çš„ç›®æ¨™ã€é€ æˆ**å…©æ¬¡å‚·å®³**ï¼ˆç®­çŸ¢æœ¬èº« + çˆ†ç‚¸ï¼‰ã€‚é€™æ˜¯æœ‰æ„ç‚ºä¹‹çš„æ©Ÿåˆ¶ï¼Œè«‹å‹¿ä¿®å¾©æ­¤ã€ŒBugã€ã€‚
- **âŒ æ¸²æŸ“é †åº**ï¼š`draw()` å‡½æ•¸ä¸­çš„ç¹ªè£½é †åºè‡³é—œé‡è¦ã€‚é™°å½± -> æœ¬é«” -> å…‰ç’° -> æŠ•å°„ç‰© -> ç‰¹æ•ˆ -> UIã€‚é¡›å€’é †åºæœƒå°è‡´è¦–è¦ºéŒ¯èª¤ã€‚
- **âŒ ç‰¹æ•ˆåŠå¾‘è¨ˆç®—**ï¼šåœ¨ `draw()` ä¸­è¨ˆç®—ç‰¹æ•ˆåŠå¾‘æ™‚ï¼Œå‹™å¿…ä½¿ç”¨ `Math.max(0, ...)` ä¿è­·ï¼Œä¸¦ä½¿ç”¨æ­£ç¢ºçš„ `maxLife` è¨ˆç®—é€²åº¦ã€‚å¦å‰‡ç•¶ `life > maxLife` æˆ– `life < 0` æ™‚ï¼Œæœƒç”¢ç”Ÿè² åŠå¾‘å°è‡´ `IndexSizeError` å´©æ½°ã€‚
- **âŒ é™£åˆ—æ“ä½œ**ï¼šåœ¨éæ­· `snake` æˆ– `enemies` é™£åˆ—æ™‚é€²è¡Œ `splice` ç§»é™¤å…ƒç´ æ¥µæ˜“å°è‡´ç´¢å¼•éŒ¯èª¤æˆ–é–ƒçˆã€‚è«‹ä½¿ç”¨å€’åºéæ­·æˆ–æ¨™è¨˜ç§»é™¤æ³•ã€‚

### 3. é—œéµæ©Ÿåˆ¶å¯¦ä½œç´°ç¯€
- **æ­»äº¡é‚è¼¯**ï¼š
  - ç©å®¶æ­»äº¡æ™‚ä¸æœƒç«‹å³è§¸ç™¼ `triggerGameOver`ï¼Œè€Œæ˜¯èª¿ç”¨ `startPlayerDeath` é€²å…¥ç´„ 1 ç§’çš„ã€Œæ­»äº¡å‹•ç•«ã€ç‹€æ…‹ã€‚
  - æ­¤æ™‚ `isPlayerDying = true`ï¼ŒéŠæˆ²é‚è¼¯ï¼ˆç§»å‹•ã€æ€ªç‰©ï¼‰æš«åœï¼Œåªæ’­æ”¾ç‰¹æ•ˆã€‚
  - éšŠé•·ä¸æœƒæ¶ˆå¤±ï¼Œè€Œæ˜¯è®Šç´…ä¸¦è¦†è“‹å´©è§£ç‰¹æ•ˆ (`player-disintegrate`)ã€‚
- **æ’ç‰†è™•ç†**ï¼š
  - åœ¨ `moveSnake` ä¸­æª¢æ¸¬åˆ°æ’ç‰†å¾Œï¼Œç›´æ¥èª¿ç”¨ `startPlayerDeath` ä¸¦ `return`ï¼Œ**ä¸åŸ·è¡Œ**å¾ŒçºŒçš„ä½ç½®æ›´æ–°ã€‚é€™ç¢ºä¿ç©å®¶åœåœ¨æ’æ“Šé»ï¼ˆåŸåœ°æ­»äº¡ï¼‰ï¼Œä¸æœƒæœ‰è¦–è¦ºä¸Šçš„å›å½ˆã€‚
- **ç„¡æ•µæ©Ÿåˆ¶**ï¼š
  - **éšŠä¼ç´šåˆ¥åˆ¤å®š**ï¼šåœ¨ `updateEnemies` ä¸­ï¼Œç¢°æ’æª¢æ¸¬å‰å…ˆæª¢æŸ¥ `invincibilityEndTime`ã€‚å¦‚æœç„¡æ•µï¼Œè·³éæ‰€æœ‰ç¢°æ’é‚è¼¯ã€‚é€™è§£æ±ºäº†å¤šæ€ªåŒæ™‚æ”»æ“Šå°è‡´ç¬é–“ç§’æ®ºçš„å•é¡Œã€‚
  - **å†·å»æ™‚é–“**ï¼šç¢°æ’å†·å»æ™‚é–“è¨­ç‚º 500msã€‚

### 4. é¿å…å¸¸è¦‹é–‹ç™¼éŒ¯èª¤
- **âŒ é¿å…ã€Œå¹½éˆä»£ç¢¼ã€(Mock Code Overlay)**ï¼šç¦æ­¢åœ¨æª”æ¡ˆå°¾ç«¯æ·»åŠ ã€Œè‡¨æ™‚æ¸¬è©¦ç”¨ã€çš„å‡½æ•¸ã€‚
- **âŒ å‡½æ•¸å”¯ä¸€æ€§**ï¼šåœ¨æ–°å¢å‡½æ•¸å‰ï¼Œå…ˆæœå°‹æ˜¯å¦å·²å­˜åœ¨åŒåå‡½æ•¸ã€‚

---

### 5. æ–°å¢ç³»çµ±å¯¦ä½œç´°ç¯€ (v1.4+)

#### æ­»äº¡èˆ‡ç‰¹æ•ˆç³»çµ±
- **å»¶é² Game Over**ï¼šä½¿ç”¨ `isPlayerDying` å’Œ `deathTimer` å¯¦ä½œã€‚
- **ç‰¹æ•ˆé˜²è­·**ï¼šæ‰€æœ‰ç‰¹æ•ˆåœ¨ç¹ªè£½æ™‚éƒ½æœ‰è² åŠå¾‘ä¿è­·ã€‚
- **å´©è§£ç‰¹æ•ˆ**ï¼š`player-disintegrate` ä½¿ç”¨åƒç´ æ–¹å¡Šé£›æ•£æ•ˆæœï¼Œç¹ªè£½æ™‚éœ€æ³¨æ„åº§æ¨™è½‰æ›ï¼ˆä¸–ç•Œåº§æ¨™ -> è¢å¹•åº§æ¨™ï¼‰ã€‚

#### çŸ³é ­ç”Ÿæˆèˆ‡ç¢°æ’
- **ç”Ÿæˆä¿è­·æœŸ**ï¼šçŸ³é ­ç”Ÿæˆå¾Œçš„å‰ 2 ç§’ (`SPAWN_PROTECTION_TIME`) ç‚ºåŠé€æ˜ä¸”ç„¡ç¢°æ’é«”ç©ï¼Œé¿å…ç©å®¶ã€Œå†¤æ­»ã€ã€‚
- **ç¢°æ’é‚è¼¯**ï¼š
  - ç©å®¶ï¼š`moveSnake` ä¸­æª¢æŸ¥ç¶²æ ¼åº§æ¨™é‡ç–Šã€‚
  - æ€ªç‰©ï¼š`updateEnemies` ä¸­æª¢æŸ¥åœ“å½¢èˆ‡çŸ©å½¢ç¢°æ’ï¼Œæœ‰å†·å»æ™‚é–“ï¼Œå†·å»ä¸­å…è¨±ã€Œæ“ éå»ã€ã€‚
  - å¼“ç®­ï¼š`updateProjectiles` ä¸­æª¢æŸ¥é»èˆ‡çŸ©å½¢ç¢°æ’ï¼Œæ’åˆ°æ¶ˆå¤±ã€‚

#### éšŠå“¡ç®¡ç†
- **æ­»äº¡ç‰¹æ•ˆ**ï¼šéšŠå“¡æ­»äº¡æ™‚è§¸ç™¼ `member-death`ï¼ˆè¡€éœ§ï¼‰ã€‚
- **æ‹›å‹Ÿé‚è¼¯**ï¼šé¨å£«æ­»äº¡çå‹µ (`deathBonus`) æœƒåœ¨é¨å£«æ­»äº¡æ™‚è§¸ç™¼ï¼Œéš¨æ©Ÿæ‹›å‹ŸæŒ‡å®šæ•¸é‡çš„æ–°éšŠå“¡ã€‚

## ç§»å‹•æµæš¢åº¦ï¼šç·šæ€§æ’å€¼ vs æŒ‡æ•¸æ’å€¼

### å•é¡Œæè¿°
å¯¦ä½œç¢°æ’æ•ˆæœå¾Œï¼Œç©å®¶ç§»å‹•å‡ºç¾æ˜é¡¯å¡é “ï¼Œæœ‰ã€Œä¸€æ ¼ä¸€æ ¼è·³å‹•ã€çš„æ„Ÿè¦ºã€‚æ€ªç‰©ç§»å‹•å»å¾ˆå¹³æ»‘ã€‚

### è§£æ±ºæ–¹æ¡ˆï¼šç·šæ€§æ’å€¼
ä½¿ç”¨**ç·šæ€§æ’å€¼**ï¼ˆLinear Interpolationï¼‰ï¼š
```javascript
// âœ… æ­£ç¢ºï¼šç·šæ€§æ’å€¼
const moveProgress = Math.min(timeSinceMove / currentMoveSpeed, 1); // 0.0 åˆ° 1.0
s.renderX = s.startRenderX + (s.targetRenderX - s.startRenderX) * moveProgress;
s.renderY = s.startRenderY + (s.targetRenderY - s.startRenderY) * moveProgress;
```

### é—œéµå¯¦ä½œç´°ç¯€
1. **è¨˜éŒ„æ’å€¼èµ·é»**ï¼šåœ¨ `moveSnake` ä¸­ï¼Œç•¶é‚è¼¯ä½ç½®æ›´æ–°æ™‚ï¼Œè¨˜éŒ„ `startRenderX/Y`ã€‚
2. **åœ¨ gameLoop ä¸­æ¯å¹€åŸ·è¡Œæ’å€¼**ï¼šæ ¹æ“š `timeSinceMove` è¨ˆç®— `renderX/Y`ã€‚
3. **åˆå§‹åŒ–æ­£ç¢ºæ€§**ï¼šåœ¨ `startGame` ä¸­ç¢ºä¿æ‰€æœ‰å±¬æ€§éƒ½æœ‰åˆå§‹å€¼ã€‚

### å¸¸è¦‹éŒ¯èª¤
âŒ **éŒ¯èª¤ 1**ï¼šåœ¨ `moveSnake` ä¸­é‡ç½® `renderX/Y`ï¼ˆå°è‡´è·³å‹•ï¼‰ã€‚
âŒ **éŒ¯èª¤ 2**ï¼šä½¿ç”¨æŒ‡æ•¸æ’å€¼ï¼ˆå°è‡´é€Ÿåº¦ä¸å‡ï¼‰ã€‚
âŒ **éŒ¯èª¤ 3**ï¼šä¸è¨˜éŒ„èµ·å§‹ä½ç½®ï¼ˆå°è‡´æ’å€¼éŒ¯èª¤ï¼‰ã€‚

## Canvas åº§æ¨™è½‰æ›

### å•é¡Œæè¿°
æ»‘é¼ æ‹–æ›³æ™‚ï¼Œè»Œè·¡ç·šæ®µå‡ºç¾åœ¨æ»‘é¼ ä¸‹æ–¹ç´„ 136px çš„ä½ç½®ã€‚

### è§£æ±ºæ–¹æ¡ˆ
ä½¿ç”¨ `getBoundingClientRect()` è½‰æ›åº§æ¨™ï¼š
```javascript
function getCanvasCoordinates(e) {
    const rect = canvas.getBoundingClientRect();
    return {
        x: e.clientX - rect.left,
        y: e.clientY - rect.top
    };
}
```
